#!/bin/bash
# need bash !!!

CONF_SRC_DIR=(
    vfs_simfs
    vfs_module
    test/vfs_syscall_test1
)

CONF_SRC_C_1=(
)

CONF_SRC_C_2=(
)

CONF_SRC_C_3=(
)

CONF_SRC_CPP_1=(
)

CONF_SRC_CPP_2=(
)

CONF_SRC_CPP_3=(
)

CONF_SRC_S_1=(
)

CONF_SRC_S_2=(
)

CONF_SRC_S_3=(
)


rm -rf makefile

echo -e "include mkenv.mk" >> makefile
echo -e "" >> makefile

echo -e "all: \$(TARGET)" >> makefile
echo -e "" >> makefile

for item in ${CONF_SRC_DIR[*]};
do

echo -e "OBJ += \$(patsubst %.cpp, \$(BUILD)/$item/%.cpp.o, \$(notdir \$(wildcard \$(TOP)/$item/*.cpp)))" >> makefile
echo -e "OBJ_DIR += \$(patsubst %.cpp, \$(BUILD)/$item/%.cpp.o, \$(notdir \$(wildcard \$(TOP)/$item/*.cpp)))" >> makefile
echo -e "" >> makefile

echo -e "OBJ += \$(patsubst %.c, \$(BUILD)/$item/%.c.o,  \$(notdir \$(wildcard \$(TOP)/$item/*.c)))" >> makefile
echo -e "OBJ_DIR += \$(patsubst %.c, \$(BUILD)/$item/%.c.o,  \$(notdir \$(wildcard \$(TOP)/$item/*.c)))" >> makefile
echo -e "" >> makefile

echo -e "OBJ += \$(patsubst %.S, \$(BUILD)/$item/%.S.o,  \$(notdir \$(wildcard \$(TOP)/$item/*.S)))" >> makefile
echo -e "OBJ_DIR += \$(patsubst %.S, \$(BUILD)/$item/%.S.o,  \$(notdir \$(wildcard \$(TOP)/$item/*.S)))" >> makefile
echo -e "" >> makefile

echo -e "\$(BUILD)/$item/%.cpp.o: \$(TOP)/$item/%.cpp \$(BUILD)" >> makefile
echo -e "\t\$(CXX) -c \$(CXXFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile

echo -e "\$(BUILD)/$item/%.c.o:  \$(TOP)/$item/%.c \$(BUILD)" >> makefile
echo -e "\t\$(CC) -c \$(CFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile

echo -e "\$(BUILD)/$item/%.S.o:  \$(TOP)/$item/%.S \$(BUILD)" >> makefile
echo -e "\t\$(AS) -c \$(ASFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile

done

for item in ${CONF_SRC_C_1[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_C_1 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o:  \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(CC) -c \$(CFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_C_2[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_C_2 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o:  \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(CC) -c \$(CFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_C_3[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_C_3 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/ $item \$(BUILD)" >> makefile
echo -e "\t\$(CC) -c \$(CFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_CPP_1[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_CPP_1 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(CXX) -c \$(CXXFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_CPP_2[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_CPP_2 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(CXX) -c \$(CXXFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_CPP_3[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_CPP_3 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(CXX) -c \$(CXXFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_S_1[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_S_1 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(AS) -c \$(ASFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_S_2[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_S_2 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(AS) -c \$(ASFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile


done

for item in ${CONF_SRC_S_3[*]};
do
echo -e "OBJ += \$(BUILD)/$item.o" >> makefile
echo -e "OBJ_S_3 += \$(BUILD)/$item.o" >> makefile
echo -e "" >> makefile
echo -e "\$(BUILD)/$item.o: \$(TOP)/$item \$(BUILD)" >> makefile
echo -e "\t\$(AS) -c \$(ASFLAGS) \$(INC) -o \$@ \$<" >> makefile
echo -e "" >> makefile
done



echo -e "\$(BUILD):" >> makefile

for item in ${CONF_SRC_DIR[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/$item" >> makefile
done

for item in ${CONF_SRC_C_1[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_C_2[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_C_3[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_CPP_1[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_CPP_2[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_CPP_3[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_S_1[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_S_2[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

for item in ${CONF_SRC_S_3[*]};
do
echo -e "\t\$(MKDIR) -p \$(BUILD)/\$(dir $item)" >> makefile
done

echo -e "" >> makefile

echo -e "clean:" >> makefile
echo -e "\trm -rf \$(BUILD)" >> makefile
echo -e "" >> makefile

echo -e "totalclean: clean" >> makefile
echo -e "\trm -rf makefile" >> makefile
echo -e "" >> makefile

echo -e "include mkrule.mk" >> makefile